<!doctype html>
<html>
<head>
  <script src="../lib/ts.app-umd.js"></script>
</head>
<body>
<!-- <button onclick="init()">init</button> -->
<script>
(function() {
  var appId = window.location.search.substring(6);
  var appIds = [
      'Tradeshift.Chrome',
      'Tradeshift.ForeignSandbox',
      'Tradeshift.Foreign',
      'Tradeshift.SameSandbox',
      'Tradeshift.Same'
    ].filter(function(oneAppId) {
    return oneAppId !== appId;
  });

  setTimeout(function() {
    var app = ts.app();
    // setTimeout(function() {
    //   var sameApp = ts.app();
    // }, 3000);
    app.on(function(message) {
      console.log(appId, '>', message.topic);
    });
    var unregister = app.on('hello', function() {
      console.log(appId, 'this handler will only be called once');
      unregister();
    });

    setTimeout(function() {
      var target = appIds[Math.floor(Math.random() * appIds.length)];
      try {
        app
          .publish(target, 'hello', {
            world: true
          })
          .publish(target, 'hello', {
            world: false
          })
          .publish(target, 'bye');
      } catch (error) {
        console.warn('Error caught:\n', error);
      }
    }, 1000);
  }, 0);
})();
</script>
</body>

</html>
