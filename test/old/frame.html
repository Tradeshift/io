<!doctype html>
<html>
<head>
  <script src="../lib/ts.io-umd.js"></script>
</head>
<body>
<!-- <button onclick="init()">init</button> -->
<script>
(function() {
  var appId = window.location.search.substring(6);
  var appIds = [
    'Tradeshift.Chrome',
    'Tradeshift.ForeignSandbox',
    'Tradeshift.Foreign',
    'Tradeshift.SameSandbox',
    'Tradeshift.Same'
  ].filter(function(oneAppId) {
    return oneAppId !== appId;
  });

  setTimeout(function() {
    var app = ts.io();

    setTimeout(function() {
      var sameApp = ts.io();
      console.log('same instance for another ts.io()', app === sameApp);
    }, 3000);

    app.on('*', function(message) {
      console.log(appId, '>', message.topic);
    });
    var unregister = app.on('hello', function() {
      console.log(appId, 'this handler will only be called once');
      unregister();
    });
    app.once('hello', function() {
      console.log('I am once() as well.');
    });

    var target = appIds[Math.floor(Math.random() * appIds.length)];
    app.emit('hello', target, {
      world: true
    });
    app.emit('hello', target, {
      world: false
    });
    app.emit('bye', target);

    setTimeout(function() {
      console.log('spawning now!');
      app.call('spawn', target, { some: 'data' });
    }, 500);
  }, 0);
})();
</script>
</body>

</html>
