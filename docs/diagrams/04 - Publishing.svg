<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1863px" preserveAspectRatio="none" style="width:2328px;height:1863px;" version="1.1" viewBox="0 0 2328 1863" width="2328px" zoomAndPan="magnify"><defs><filter height="300%" id="f72can5mp9cs8" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="Open Sans" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="1053.25" y="29.9639">Publishing -</text><text fill="#000000" font-family="monospace" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="1138.25" y="30.7637">ts.app.publish()</text><rect fill="#E0FBFC" height="1805.7515" style="stroke: #9DB4C0; stroke-width: 1.0;" width="883" x="29" y="47.0654"/><text fill="#000000" font-family="Open Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="163" x="389" y="65.9604">Tradeshift.MyApp iframe</text><rect fill="#C2DFE3" height="1805.7515" style="stroke: #9DB4C0; stroke-width: 1.0;" width="591.5" x="1499" y="47.0654"/><text fill="#000000" font-family="Open Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="186" x="1701.75" y="65.9604">tradeshift-chrome topframe</text><rect fill="#9DB4C0" height="1805.7515" style="stroke: #9DB4C0; stroke-width: 1.0;" width="168" x="2112.5" y="47.0654"/><text fill="#000000" font-family="Open Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="2139" y="65.9604">Other.App iframe</text><rect fill="#F4FFFF" filter="url(#f72can5mp9cs8)" height="818.9912" style="stroke: #9DB4C0; stroke-width: 1.0;" width="906.5" x="781" y="236.9673"/><rect fill="#F4FFFF" height="307.4219" style="stroke: none; stroke-width: 1.0;" width="906.5" x="781" y="362.8491"/><rect fill="#F4FFFF" height="385.6875" style="stroke: none; stroke-width: 1.0;" width="906.5" x="781" y="670.271"/><rect fill="#F4FFFF" filter="url(#f72can5mp9cs8)" height="675.793" style="stroke: #9DB4C0; stroke-width: 1.0;" width="813.5" x="1483" y="1069.9585"/><rect fill="#F4FFFF" filter="url(#f72can5mp9cs8)" height="620.7476" style="stroke: #9DB4C0; stroke-width: 1.0;" width="793.5" x="1493" y="1118.0039"/><rect fill="#F4FFFF" height="207.0146" style="stroke: none; stroke-width: 1.0;" width="793.5" x="1493" y="1198.1821"/><rect fill="#F4FFFF" height="333.5547" style="stroke: none; stroke-width: 1.0;" width="793.5" x="1493" y="1405.1968"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="107" x2="107" y1="126.8345" y2="138.8345"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="107" x2="107" y1="138.8345" y2="176.8345"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="107" x2="107" y1="176.8345" y2="1752.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="107" x2="107" y1="1752.7515" y2="1790.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="107" x2="107" y1="1790.7515" y2="1791.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="107" x2="107" y1="1791.7515" y2="1801.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="509" x2="509" y1="126.8345" y2="138.8345"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="509" x2="509" y1="138.8345" y2="176.8345"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="509" x2="509" y1="176.8345" y2="1752.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="509" x2="509" y1="1752.7515" y2="1790.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="509" x2="509" y1="1790.7515" y2="1791.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="509" x2="509" y1="1791.7515" y2="1801.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="849" x2="849" y1="126.8345" y2="138.8345"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="849" x2="849" y1="138.8345" y2="176.8345"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="849" x2="849" y1="176.8345" y2="1752.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="849" x2="849" y1="1752.7515" y2="1790.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="849" x2="849" y1="1790.7515" y2="1791.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="849" x2="849" y1="1791.7515" y2="1801.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="1563" x2="1563" y1="126.8345" y2="138.8345"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1563" x2="1563" y1="138.8345" y2="176.8345"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="1563" x2="1563" y1="176.8345" y2="1752.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1563" x2="1563" y1="1752.7515" y2="1790.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="1563" x2="1563" y1="1790.7515" y2="1791.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1563" x2="1563" y1="1791.7515" y2="1801.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="2011.5" x2="2011.5" y1="126.8345" y2="138.8345"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="2011.5" x2="2011.5" y1="138.8345" y2="176.8345"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="2011.5" x2="2011.5" y1="176.8345" y2="1752.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="2011.5" x2="2011.5" y1="1752.7515" y2="1790.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="2011.5" x2="2011.5" y1="1790.7515" y2="1791.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="2011.5" x2="2011.5" y1="1791.7515" y2="1801.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="2196.5" x2="2196.5" y1="126.8345" y2="138.8345"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="2196.5" x2="2196.5" y1="138.8345" y2="176.8345"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="2196.5" x2="2196.5" y1="176.8345" y2="1752.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="2196.5" x2="2196.5" y1="1752.7515" y2="1790.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0;" x1="2196.5" x2="2196.5" y1="1790.7515" y2="1791.7515"/><line style="stroke: #5C6B73; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="2196.5" x2="2196.5" y1="1791.7515" y2="1801.7515"/><rect fill="#5C6B73" filter="url(#f72can5mp9cs8)" height="43.0654" style="stroke: #5C6B73; stroke-width: 1.5;" width="144" x="33" y="78.769"/><text fill="#FFFFFF" font-family="Open Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="45" y="105.7329">Tradeshift.MyApp</text><rect fill="#5C6B73" filter="url(#f72can5mp9cs8)" height="43.0654" style="stroke: #5C6B73; stroke-width: 1.5;" width="144" x="33" y="1800.7515"/><text fill="#FFFFFF" font-family="Open Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="45" y="1827.7153">Tradeshift.MyApp</text><rect fill="#5C6B73" filter="url(#f72can5mp9cs8)" height="43.0654" style="stroke: #5C6B73; stroke-width: 1.5;" width="66" x="474" y="78.769"/><text fill="#FFFFFF" font-family="Open Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="486" y="105.7329">ts.app</text><rect fill="#5C6B73" filter="url(#f72can5mp9cs8)" height="43.0654" style="stroke: #5C6B73; stroke-width: 1.5;" width="66" x="474" y="1800.7515"/><text fill="#FFFFFF" font-family="Open Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="486" y="1827.7153">ts.app</text><rect fill="#5C6B73" filter="url(#f72can5mp9cs8)" height="43.0654" style="stroke: #5C6B73; stroke-width: 1.5;" width="113" x="791" y="78.769"/><text fill="#FFFFFF" font-family="Open Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="89" x="803" y="105.7329">ts.amp.Client</text><rect fill="#5C6B73" filter="url(#f72can5mp9cs8)" height="43.0654" style="stroke: #5C6B73; stroke-width: 1.5;" width="113" x="791" y="1800.7515"/><text fill="#FFFFFF" font-family="Open Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="89" x="803" y="1827.7153">ts.amp.Client</text><rect fill="#5C6B73" filter="url(#f72can5mp9cs8)" height="43.0654" style="stroke: #5C6B73; stroke-width: 1.5;" width="117" x="1503" y="78.769"/><text fill="#FFFFFF" font-family="Open Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1515" y="105.7329">ts.amp.Server</text><rect fill="#5C6B73" filter="url(#f72can5mp9cs8)" height="43.0654" style="stroke: #5C6B73; stroke-width: 1.5;" width="117" x="1503" y="1800.7515"/><text fill="#FFFFFF" font-family="Open Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1515" y="1827.7153">ts.amp.Server</text><rect fill="#5C6B73" filter="url(#f72can5mp9cs8)" height="43.0654" style="stroke: #5C6B73; stroke-width: 1.5;" width="146" x="1936.5" y="78.769"/><text fill="#FFFFFF" font-family="Open Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122" x="1948.5" y="105.7329">tradeshift-chrome</text><rect fill="#5C6B73" filter="url(#f72can5mp9cs8)" height="43.0654" style="stroke: #5C6B73; stroke-width: 1.5;" width="146" x="1936.5" y="1800.7515"/><text fill="#FFFFFF" font-family="Open Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122" x="1948.5" y="1827.7153">tradeshift-chrome</text><rect fill="#5C6B73" filter="url(#f72can5mp9cs8)" height="43.0654" style="stroke: #5C6B73; stroke-width: 1.5;" width="156" x="2116.5" y="78.769"/><text fill="#FFFFFF" font-family="Open Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="132" x="2128.5" y="105.7329">Other ts.amp.Client</text><rect fill="#5C6B73" filter="url(#f72can5mp9cs8)" height="43.0654" style="stroke: #5C6B73; stroke-width: 1.5;" width="156" x="2116.5" y="1800.7515"/><text fill="#FFFFFF" font-family="Open Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="132" x="2128.5" y="1827.7153">Other ts.amp.Client</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="3" x2="2316.5" y1="137.8345" y2="137.8345"/><line style="stroke: #253237; stroke-width: 2.0;" x1="507" x2="497" y1="207.8345" y2="203.8345"/><line style="stroke: #253237; stroke-width: 2.0;" x1="507" x2="497" y1="207.8345" y2="211.8345"/><line style="stroke: #253237; stroke-width: 2.0;" x1="107" x2="508" y1="207.8345" y2="207.8345"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="119" y="197.9014">ts.app.publish(ts.app.Message)</text><line style="stroke: #253237; stroke-width: 2.0;" x1="847.5" x2="837.5" y1="221.9673" y2="217.9673"/><line style="stroke: #253237; stroke-width: 2.0;" x1="847.5" x2="837.5" y1="221.9673" y2="225.9673"/><line style="stroke: #253237; stroke-width: 2.0;" x1="509" x2="848.5" y1="221.9673" y2="221.9673"/><rect fill="none" height="818.9912" style="stroke: #9DB4C0; stroke-width: 1.0;" width="906.5" x="781" y="236.9673"/><polygon fill="#EAFFFF" points="781,236.9673,854,236.9673,854,255.9673,844,265.9673,781,265.9673,781,236.9673" style="stroke: #9DB4C0; stroke-width: 1.0;"/><text fill="#000000" font-family="Open Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="801" y="256.8623">alt</text><text fill="#000000" font-family="Open Sans" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="874" y="256.7935">[QoS Level 0]</text><line style="stroke: #253237; stroke-width: 2.0;" x1="1561.5" x2="1551.5" y1="309.0127" y2="305.0127"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1561.5" x2="1551.5" y1="309.0127" y2="313.0127"/><line style="stroke: #253237; stroke-width: 2.0;" x1="849.5" x2="1562.5" y1="309.0127" y2="309.0127"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="861.5" y="299.0796">PUBLISH("topic", payload, QoS=0)</text><polygon fill="#E8F6FF" filter="url(#f72can5mp9cs8)" points="1515,322.1455,1612,322.1455,1622,339.1455,1612,357.1455,1515,357.1455,1505,339.1455,1515,322.1455" style="stroke: #224F6B; stroke-width: 1.0;"/><text fill="#1F2D3D" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="1522" y="345.0405">Identify Client</text><line style="stroke: #9DB4C0; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="781" x2="1687.5" y1="363.8491" y2="363.8491"/><text fill="#000000" font-family="Open Sans" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="791" y="381.6753">[QoS Level 1]</text><line style="stroke: #253237; stroke-width: 2.0;" x1="1561.5" x2="1551.5" y1="422.1909" y2="418.1909"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1561.5" x2="1551.5" y1="422.1909" y2="426.1909"/><line style="stroke: #253237; stroke-width: 2.0;" x1="849.5" x2="1562.5" y1="422.1909" y2="422.1909"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="861.5" y="412.2578">PUBLISH("topic", payload, QoS=1)</text><polygon fill="#E8F6FF" filter="url(#f72can5mp9cs8)" points="1515,435.3237,1612,435.3237,1622,452.3237,1612,470.3237,1515,470.3237,1505,452.3237,1515,435.3237" style="stroke: #224F6B; stroke-width: 1.0;"/><text fill="#1F2D3D" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="1522" y="458.2188">Identify Client</text><line style="stroke: #253237; stroke-width: 2.0;" x1="1563.5" x2="1605.5" y1="509.731" y2="509.731"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1605.5" x2="1605.5" y1="509.731" y2="522.731"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1564.5" x2="1605.5" y1="522.731" y2="522.731"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1564.5" x2="1574.5" y1="522.731" y2="518.731"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1564.5" x2="1574.5" y1="522.731" y2="526.731"/><text fill="#000000" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1575.5" y="498.9224">Persist message</text><line style="stroke: #253237; stroke-width: 2.0;" x1="849.5" x2="859.5" y1="561.731" y2="557.731"/><line style="stroke: #253237; stroke-width: 2.0;" x1="849.5" x2="859.5" y1="561.731" y2="565.731"/><line style="stroke: #253237; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="849.5" x2="1562.5" y1="561.731" y2="561.731"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="871.5" y="551.7979">PUBACK</text><polygon fill="#E8F6FF" filter="url(#f72can5mp9cs8)" points="1515,574.8638,1612,574.8638,1622,591.8638,1612,609.8638,1515,609.8638,1505,591.8638,1515,574.8638" style="stroke: #224F6B; stroke-width: 1.0;"/><text fill="#1F2D3D" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="1522" y="597.7588">Identify Client</text><line style="stroke: #253237; stroke-width: 2.0;" x1="849.5" x2="891.5" y1="649.271" y2="649.271"/><line style="stroke: #253237; stroke-width: 2.0;" x1="891.5" x2="891.5" y1="649.271" y2="662.271"/><line style="stroke: #253237; stroke-width: 2.0;" x1="850.5" x2="891.5" y1="662.271" y2="662.271"/><line style="stroke: #253237; stroke-width: 2.0;" x1="850.5" x2="860.5" y1="662.271" y2="658.271"/><line style="stroke: #253237; stroke-width: 2.0;" x1="850.5" x2="860.5" y1="662.271" y2="666.271"/><text fill="#000000" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="861.5" y="638.4624">Delete message</text><line style="stroke: #9DB4C0; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="781" x2="1687.5" y1="671.271" y2="671.271"/><text fill="#000000" font-family="Open Sans" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="791" y="689.0972">[QoS Level 2]</text><line style="stroke: #253237; stroke-width: 2.0;" x1="1561.5" x2="1551.5" y1="729.6128" y2="725.6128"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1561.5" x2="1551.5" y1="729.6128" y2="733.6128"/><line style="stroke: #253237; stroke-width: 2.0;" x1="849.5" x2="1562.5" y1="729.6128" y2="729.6128"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="861.5" y="719.6797">PUBLISH("topic", payload, QoS=2)</text><polygon fill="#E8F6FF" filter="url(#f72can5mp9cs8)" points="1515,742.7456,1612,742.7456,1622,759.7456,1612,777.7456,1515,777.7456,1505,759.7456,1515,742.7456" style="stroke: #224F6B; stroke-width: 1.0;"/><text fill="#1F2D3D" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="1522" y="765.6406">Identify Client</text><line style="stroke: #253237; stroke-width: 2.0;" x1="1563.5" x2="1605.5" y1="817.1528" y2="817.1528"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1605.5" x2="1605.5" y1="817.1528" y2="830.1528"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1564.5" x2="1605.5" y1="830.1528" y2="830.1528"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1564.5" x2="1574.5" y1="830.1528" y2="826.1528"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1564.5" x2="1574.5" y1="830.1528" y2="834.1528"/><text fill="#000000" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1575.5" y="806.3442">Persist message</text><line style="stroke: #253237; stroke-width: 2.0;" x1="849.5" x2="859.5" y1="869.1528" y2="865.1528"/><line style="stroke: #253237; stroke-width: 2.0;" x1="849.5" x2="859.5" y1="869.1528" y2="873.1528"/><line style="stroke: #253237; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="849.5" x2="1562.5" y1="869.1528" y2="869.1528"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="871.5" y="859.2197">PUBREC</text><line style="stroke: #253237; stroke-width: 2.0;" x1="1561.5" x2="1551.5" y1="908.2856" y2="904.2856"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1561.5" x2="1551.5" y1="908.2856" y2="912.2856"/><line style="stroke: #253237; stroke-width: 2.0;" x1="849.5" x2="1562.5" y1="908.2856" y2="908.2856"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="861.5" y="898.3525">PUBREL</text><polygon fill="#E8F6FF" filter="url(#f72can5mp9cs8)" points="1515,921.4185,1612,921.4185,1622,938.4185,1612,956.4185,1515,956.4185,1505,938.4185,1515,921.4185" style="stroke: #224F6B; stroke-width: 1.0;"/><text fill="#1F2D3D" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="1522" y="944.3135">Identify Client</text><line style="stroke: #253237; stroke-width: 2.0;" x1="849.5" x2="859.5" y1="993.1221" y2="989.1221"/><line style="stroke: #253237; stroke-width: 2.0;" x1="849.5" x2="859.5" y1="993.1221" y2="997.1221"/><line style="stroke: #253237; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="849.5" x2="1562.5" y1="993.1221" y2="993.1221"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="871.5" y="983.189">PUBCOMP</text><line style="stroke: #253237; stroke-width: 2.0;" x1="849.5" x2="891.5" y1="1034.9585" y2="1034.9585"/><line style="stroke: #253237; stroke-width: 2.0;" x1="891.5" x2="891.5" y1="1034.9585" y2="1047.9585"/><line style="stroke: #253237; stroke-width: 2.0;" x1="850.5" x2="891.5" y1="1047.9585" y2="1047.9585"/><line style="stroke: #253237; stroke-width: 2.0;" x1="850.5" x2="860.5" y1="1047.9585" y2="1043.9585"/><line style="stroke: #253237; stroke-width: 2.0;" x1="850.5" x2="860.5" y1="1047.9585" y2="1051.9585"/><text fill="#000000" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="861.5" y="1024.1499">Delete message</text><rect fill="none" height="675.793" style="stroke: #9DB4C0; stroke-width: 1.0;" width="813.5" x="1483" y="1069.9585"/><polygon fill="#EAFFFF" points="1483,1069.9585,1566,1069.9585,1566,1088.9585,1556,1098.9585,1483,1098.9585,1483,1069.9585" style="stroke: #9DB4C0; stroke-width: 1.0;"/><text fill="#000000" font-family="Open Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1503" y="1089.8535">loop</text><text fill="#000000" font-family="Open Sans" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="224" x="1586" y="1089.7847">[For each client subscribed to "topic"]</text><rect fill="none" height="620.7476" style="stroke: #9DB4C0; stroke-width: 1.0;" width="793.5" x="1493" y="1118.0039"/><polygon fill="#EAFFFF" points="1493,1118.0039,1566,1118.0039,1566,1137.0039,1556,1147.0039,1493,1147.0039,1493,1118.0039" style="stroke: #9DB4C0; stroke-width: 1.0;"/><text fill="#000000" font-family="Open Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1513" y="1137.8989">alt</text><text fill="#000000" font-family="Open Sans" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="1586" y="1137.8301">[QoS Level 0]</text><line style="stroke: #253237; stroke-width: 2.0;" x1="2194.5" x2="2184.5" y1="1190.0493" y2="1186.0493"/><line style="stroke: #253237; stroke-width: 2.0;" x1="2194.5" x2="2184.5" y1="1190.0493" y2="1194.0493"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1563.5" x2="2195.5" y1="1190.0493" y2="1190.0493"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="1575.5" y="1180.1162">PUBLISH("topic", payload, QoS=0)</text><line style="stroke: #9DB4C0; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1493" x2="2286.5" y1="1199.1821" y2="1199.1821"/><text fill="#000000" font-family="Open Sans" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="1503" y="1217.0083">[QoS Level 1]</text><line style="stroke: #253237; stroke-width: 2.0;" x1="2194.5" x2="2184.5" y1="1257.5239" y2="1253.5239"/><line style="stroke: #253237; stroke-width: 2.0;" x1="2194.5" x2="2184.5" y1="1257.5239" y2="1261.5239"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1563.5" x2="2195.5" y1="1257.5239" y2="1257.5239"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="1575.5" y="1247.5908">PUBLISH("topic", payload, QoS=1)</text><line style="stroke: #253237; stroke-width: 2.0;" x1="1563.5" x2="1573.5" y1="1296.6567" y2="1292.6567"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1563.5" x2="1573.5" y1="1296.6567" y2="1300.6567"/><line style="stroke: #253237; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="1563.5" x2="2195.5" y1="1296.6567" y2="1296.6567"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="1585.5" y="1286.7236">PUBACK</text><polygon fill="#E8F6FF" filter="url(#f72can5mp9cs8)" points="1515,1309.7896,1612,1309.7896,1622,1326.7896,1612,1344.7896,1515,1344.7896,1505,1326.7896,1515,1309.7896" style="stroke: #224F6B; stroke-width: 1.0;"/><text fill="#1F2D3D" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="1522" y="1332.6846">Identify Client</text><line style="stroke: #253237; stroke-width: 2.0;" x1="1563.5" x2="1605.5" y1="1384.1968" y2="1384.1968"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1605.5" x2="1605.5" y1="1384.1968" y2="1397.1968"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1564.5" x2="1605.5" y1="1397.1968" y2="1397.1968"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1564.5" x2="1574.5" y1="1397.1968" y2="1393.1968"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1564.5" x2="1574.5" y1="1397.1968" y2="1401.1968"/><text fill="#000000" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="1575.5" y="1373.3882">Delete message</text><line style="stroke: #9DB4C0; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1493" x2="2286.5" y1="1406.1968" y2="1406.1968"/><text fill="#000000" font-family="Open Sans" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="1503" y="1424.0229">[QoS Level 2]</text><line style="stroke: #253237; stroke-width: 2.0;" x1="2194.5" x2="2184.5" y1="1464.5386" y2="1460.5386"/><line style="stroke: #253237; stroke-width: 2.0;" x1="2194.5" x2="2184.5" y1="1464.5386" y2="1468.5386"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1563.5" x2="2195.5" y1="1464.5386" y2="1464.5386"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="1575.5" y="1454.6055">PUBLISH("topic", payload, QoS=2)</text><line style="stroke: #253237; stroke-width: 2.0;" x1="1563.5" x2="1573.5" y1="1503.6714" y2="1499.6714"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1563.5" x2="1573.5" y1="1503.6714" y2="1507.6714"/><line style="stroke: #253237; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="1563.5" x2="2195.5" y1="1503.6714" y2="1503.6714"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="1585.5" y="1493.7383">PUBREC</text><polygon fill="#E8F6FF" filter="url(#f72can5mp9cs8)" points="1515,1516.8042,1612,1516.8042,1622,1533.8042,1612,1551.8042,1515,1551.8042,1505,1533.8042,1515,1516.8042" style="stroke: #224F6B; stroke-width: 1.0;"/><text fill="#1F2D3D" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="1522" y="1539.6992">Identify Client</text><line style="stroke: #253237; stroke-width: 2.0;" x1="2194.5" x2="2184.5" y1="1590.5078" y2="1586.5078"/><line style="stroke: #253237; stroke-width: 2.0;" x1="2194.5" x2="2184.5" y1="1590.5078" y2="1594.5078"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1563.5" x2="2195.5" y1="1590.5078" y2="1590.5078"/><text fill="#000000" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="1575.5" y="1580.4028">""PUBREL"</text><line style="stroke: #253237; stroke-width: 2.0;" x1="1563.5" x2="1573.5" y1="1630.2114" y2="1626.2114"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1563.5" x2="1573.5" y1="1630.2114" y2="1634.2114"/><line style="stroke: #253237; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="1563.5" x2="2195.5" y1="1630.2114" y2="1630.2114"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="1585.5" y="1620.2783">PUBCOMP</text><polygon fill="#E8F6FF" filter="url(#f72can5mp9cs8)" points="1515,1643.3442,1612,1643.3442,1622,1660.3442,1612,1678.3442,1515,1678.3442,1505,1660.3442,1515,1643.3442" style="stroke: #224F6B; stroke-width: 1.0;"/><text fill="#1F2D3D" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="1522" y="1666.2393">Identify Client</text><line style="stroke: #253237; stroke-width: 2.0;" x1="1563.5" x2="1605.5" y1="1717.7515" y2="1717.7515"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1605.5" x2="1605.5" y1="1717.7515" y2="1730.7515"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1564.5" x2="1605.5" y1="1730.7515" y2="1730.7515"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1564.5" x2="1574.5" y1="1730.7515" y2="1726.7515"/><line style="stroke: #253237; stroke-width: 2.0;" x1="1564.5" x2="1574.5" y1="1730.7515" y2="1734.7515"/><text fill="#000000" font-family="Open Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="1575.5" y="1706.9429">Delete message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="3" x2="2316.5" y1="1790.7515" y2="1790.7515"/><!--
@startuml

skinparam {
	DefaultFontName Open Sans
	Padding 5
	BoxPadding 10
	Note {
		BackgroundColor #E8F6FF
		FontColor #1F2D3D
		BorderColor #224F6B
	}

	sequence {
		BoxBorderColor #9DB4C0
		Group {
			BackgroundColor #EAFFFF
			BodyBackgroundColor #F4FFFF
			BorderColor #9DB4C0
			BorderThickness 1
		}

		Arrow {
			Color #253237
			Thickness 2
		}

		LifeLine {
			BorderColor #5C6B73
		}

		Participant {
			BorderColor #5C6B73
			BackgroundColor #5C6B73
			FontColor #FFFFFF
		}

	}
}

box "Tradeshift.MyApp iframe" #E0FBFC
	participant "Tradeshift.MyApp"
	participant "ts.app"
	participant "ts.amp.Client"
end box
box "tradeshift-chrome topframe" #C2DFE3
	participant "ts.amp.Server"
	participant "tradeshift-chrome"
end box
box "Other.App iframe" #9DB4C0
	participant "Other ts.amp.Client"
end box

title Connecting - ""ts.app.connect()""

...

"Tradeshift.MyApp" -> "ts.app": ""ts.app.connect()""
create "ts.amp.Client"
"ts.app" -> "ts.amp.Client": Create internal ""ts.amp.Client"" instance
"ts.amp.Client" -> "ts.amp.Server": ""CONNECT""
hnote over "ts.amp.Server": Identify Client
"ts.amp.Client" <- - "ts.amp.Server": ""CONNACK(returnCode=0)""
"ts.amp.Server" ->> "ts.amp.Server": ""ts.amp.Server#subscribe(ts.amp.Subscription)""
note right of "ts.amp.Server": Subscribe Client to ""+/+/VendorId/AppId/#""\nOnly start publishing to Client after ""CONNACK"" was sent

...

newpage Identifying Clients

skinparam {
	DefaultFontName Open Sans
	Padding 5
	BoxPadding 10
	Note {
		BackgroundColor #E8F6FF
		FontColor #1F2D3D
		BorderColor #224F6B
	}

	sequence {
		Group {
			FontSize 12
			BackgroundColor #EAFFFF
			BodyBackgroundColor #F4FFFF
			BorderColor #9DB4C0
			BorderThickness 1
		}

		Arrow {
			Color #253237
			Thickness 2
		}

		LifeLine {
			BorderColor #5C6B73
		}

		Participant {
			BorderColor #5C6B73
			BackgroundColor #5C6B73
			FontColor #FFFFFF
		}

	}
}

box "Tradeshift.MyApp iframe" #E0FBFC
	participant "Tradeshift.MyApp"
	participant "ts.app"
	participant "ts.amp.Client"
end box
box "tradeshift-chrome topframe" #C2DFE3
	participant "ts.amp.Server"
	participant "tradeshift-chrome"
end box
box "Other.App iframe" #9DB4C0
	participant "Other ts.amp.Client"
end box

...

note over "ts.amp.Client", "ts.amp.Server": Any incoming request will be followed by an identification check
"ts.amp.Client" -> "ts.amp.Server": ""CONNECT"" /\n""PUBLISH"" / ""PUBACK"" / ""PUBREC"" / ""PUBCOMP"" /\n""SUBSCRIBE"" / ""UNSUBSCRIBE"" /\n""PINGREQ"" /\n""DISCONNECT""
group Identify
	"ts.amp.Server" -> "tradeshift-chrome": Identify ""clientId"" based on ""postMessage"" origin
	"ts.amp.Server" <- - "tradeshift-chrome"
	note right of "ts.amp.Server": If message sender can't be identified or recognized,\nthe message is ignored
end
note over "ts.amp.Server": From now on this step will be shown as follows:
hnote over "ts.amp.Server": Identify Client

...

newpage Keeping Connection Alive

skinparam {
	DefaultFontName Open Sans
	Padding 5
	BoxPadding 10
	Note {
		BackgroundColor #E8F6FF
		FontColor #1F2D3D
		BorderColor #224F6B
	}

	sequence {
		Group {
			FontSize 12
			BackgroundColor #EAFFFF
			BodyBackgroundColor #F4FFFF
			BorderColor #9DB4C0
			BorderThickness 1
		}

		Arrow {
			Color #253237
			Thickness 2
		}

		LifeLine {
			BorderColor #5C6B73
		}

		Participant {
			BorderColor #5C6B73
			BackgroundColor #5C6B73
			FontColor #FFFFFF
		}

	}
}

box "Tradeshift.MyApp iframe" #E0FBFC
	participant "Tradeshift.MyApp"
	participant "ts.app"
	participant "ts.amp.Client"
end box
box "tradeshift-chrome topframe" #C2DFE3
	participant "ts.amp.Server"
	participant "tradeshift-chrome"
end box
box "Other.App iframe" #9DB4C0
	participant "Other ts.amp.Client"
end box

...

loop Within ""keepAlive"" seconds if no other messages are sent
		"ts.amp.Client" ->> "ts.amp.Server": ""PINGREQ""
		hnote over "ts.amp.Server": Identify Client
		"ts.amp.Client" <<- - "ts.amp.Server": ""PINGRES""
	end

...

newpage Publishing - ""ts.app.publish()""

skinparam {
	DefaultFontName Open Sans
	Padding 5
	BoxPadding 10
	Note {
		BackgroundColor #E8F6FF
		FontColor #1F2D3D
		BorderColor #224F6B
	}

	sequence {
		Group {
			FontSize 12
			BackgroundColor #EAFFFF
			BodyBackgroundColor #F4FFFF
			BorderColor #9DB4C0
			BorderThickness 1
		}

		Arrow {
			Color #253237
			Thickness 2
		}

		LifeLine {
			BorderColor #5C6B73
		}

		Participant {
			BorderColor #5C6B73
			BackgroundColor #5C6B73
			FontColor #FFFFFF
		}

	}
}

box "Tradeshift.MyApp iframe" #E0FBFC
	participant "Tradeshift.MyApp"
	participant "ts.app"
	participant "ts.amp.Client"
end box
box "tradeshift-chrome topframe" #C2DFE3
	participant "ts.amp.Server"
	participant "tradeshift-chrome"
end box
box "Other.App iframe" #9DB4C0
	participant "Other ts.amp.Client"
end box

...

"Tradeshift.MyApp" ->> "ts.app": ""ts.app.publish(ts.app.Message)""
"ts.app" ->> "ts.amp.Client"
alt QoS Level 0
	"ts.amp.Client" ->> "ts.amp.Server": ""PUBLISH("topic", payload, QoS=0)""
	hnote over "ts.amp.Server": Identify Client
else QoS Level 1
	"ts.amp.Client" ->> "ts.amp.Server": ""PUBLISH("topic", payload, QoS=1)""
	hnote over "ts.amp.Server": Identify Client
	"ts.amp.Server" ->> "ts.amp.Server": Persist message
	"ts.amp.Client" <<- - "ts.amp.Server": ""PUBACK""
	hnote over "ts.amp.Server": Identify Client
	"ts.amp.Client" ->> "ts.amp.Client": Delete message
else QoS Level 2
	"ts.amp.Client" ->> "ts.amp.Server": ""PUBLISH("topic", payload, QoS=2)""
	hnote over "ts.amp.Server": Identify Client
	"ts.amp.Server" ->> "ts.amp.Server": Persist message
	"ts.amp.Client" <<- - "ts.amp.Server": ""PUBREC""
	"ts.amp.Client" ->> "ts.amp.Server": ""PUBREL""
	hnote over "ts.amp.Server": Identify Client
	"ts.amp.Client" <<- - "ts.amp.Server": ""PUBCOMP""
	"ts.amp.Client" ->> "ts.amp.Client": Delete message
end
loop For each client subscribed to "topic"
	alt QoS Level 0
		"ts.amp.Server" ->> "Other ts.amp.Client": ""PUBLISH("topic", payload, QoS=0)""
	else QoS Level 1
		"ts.amp.Server" ->> "Other ts.amp.Client": ""PUBLISH("topic", payload, QoS=1)""
		"ts.amp.Server" <<- - "Other ts.amp.Client": ""PUBACK""
		hnote over "ts.amp.Server": Identify Client
		"ts.amp.Server" ->> "ts.amp.Server": Delete message
	else QoS Level 2
		"ts.amp.Server" ->> "Other ts.amp.Client": ""PUBLISH("topic", payload, QoS=2)""
		"ts.amp.Server" <<- - "Other ts.amp.Client": ""PUBREC""
		hnote over "ts.amp.Server": Identify Client
		"ts.amp.Server" ->> "Other ts.amp.Client": ""PUBREL"
		"ts.amp.Server" <<- - "Other ts.amp.Client": ""PUBCOMP""
		hnote over "ts.amp.Server": Identify Client
		"ts.amp.Server" ->> "ts.amp.Server": Delete message
	end
end

...

newpage Listening - ""ts.app.listen()""

skinparam {
	DefaultFontName Open Sans
	Padding 5
	BoxPadding 10
	Note {
		BackgroundColor #E8F6FF
		FontColor #1F2D3D
		BorderColor #224F6B
	}

	sequence {
		Group {
			FontSize 12
			BackgroundColor #EAFFFF
			BodyBackgroundColor #F4FFFF
			BorderColor #9DB4C0
			BorderThickness 1
		}

		Arrow {
			Color #253237
			Thickness 2
		}

		LifeLine {
			BorderColor #5C6B73
		}

		Participant {
			BorderColor #5C6B73
			BackgroundColor #5C6B73
			FontColor #FFFFFF
		}

	}
}

box "Tradeshift.MyApp iframe" #E0FBFC
	participant "Tradeshift.MyApp"
	participant "ts.app"
	participant "ts.amp.Client"
end box
box "tradeshift-chrome topframe" #C2DFE3
	participant "ts.amp.Server"
	participant "tradeshift-chrome"
end box
box "Other.App iframe" #9DB4C0
	participant "Other ts.amp.Client"
end box

...

alt QoS Level 0
	"ts.amp.Server" <<- "Other ts.amp.Client": ""PUBLISH("topic", payload, Qos=0)""
	hnote over "ts.amp.Server": Identify Client
else QoS Level 1
	"ts.amp.Server" <<- "Other ts.amp.Client": ""PUBLISH("topic", payload, Qos=1)""
	hnote over "ts.amp.Server": Identify Client
	"ts.amp.Server" - ->> "Other ts.amp.Client": ""PUBACK""
	"ts.amp.Server" ->> "ts.amp.Server": Delete message
else QoS Level 2
	"ts.amp.Server" <<- "Other ts.amp.Client": ""PUBLISH("topic", payload, Qos=2)""
	hnote over "ts.amp.Server": Identify Client
	"ts.amp.Server" - ->> "Other ts.amp.Client": ""PUBREC""
	"ts.amp.Server" <<- "Other ts.amp.Client": ""PUBREL""
	hnote over "ts.amp.Server": Identify Client
	"ts.amp.Server" - ->> "Other ts.amp.Client": ""PUBCOMP""
	"ts.amp.Server" ->> "ts.amp.Server": Delete message
end
loop For each client subscribed to "topic"
	alt QoS Level 0
		"ts.amp.Client" <<- "ts.amp.Server": ""PUBLISH("topic", payload, Qos=0)""
		"ts.app" <<- "ts.amp.Client" : ""ts.app.listen(ts.app.MessageHandler)""
		"Tradeshift.MyApp" <- "ts.app" : ""messageHandler""
	else QoS Level 1
		"ts.amp.Client" <<- "ts.amp.Server": ""PUBLISH("topic", payload, Qos=1)""
		"ts.amp.Client" - ->> "ts.amp.Server": ""PUBACK""
		hnote over "ts.amp.Server": Identify Client
		"ts.amp.Server" ->> "ts.amp.Server": Delete message
		"ts.app" <<- "ts.amp.Client" : ""ts.app.listen(ts.app.MessageHandler)""
		"Tradeshift.MyApp" <- "ts.app" : ""messageHandler""
	else QoS Level 2
		"ts.amp.Client" <<- "ts.amp.Server": ""PUBLISH("topic", payload, Qos=2)""
		"ts.amp.Client" - ->> "ts.amp.Server": ""PUBREC""
		hnote over "ts.amp.Server": Identify Client
		"ts.amp.Client" <<- "ts.amp.Server": ""PUBREL""
		"ts.amp.Client" - ->> "ts.amp.Server": ""PUBCOMP""
		hnote over "ts.amp.Server": Identify Client
		"ts.amp.Server" ->> "ts.amp.Server": Delete message
		"ts.app" <<- "ts.amp.Client" : ""ts.app.listen(ts.app.MessageHandler)""
		"Tradeshift.MyApp" <- "ts.app" : ""messageHandler""
	end
end

...

newpage Subscribing - ""ts.app.subscribe()""

skinparam {
	DefaultFontName Open Sans
	Padding 5
	BoxPadding 10
	Note {
		BackgroundColor #E8F6FF
		FontColor #1F2D3D
		BorderColor #224F6B
	}

	sequence {
		Group {
			FontSize 12
			BackgroundColor #EAFFFF
			BodyBackgroundColor #F4FFFF
			BorderColor #9DB4C0
			BorderThickness 1
		}

		Arrow {
			Color #253237
			Thickness 2
		}

		LifeLine {
			BorderColor #5C6B73
		}

		Participant {
			BorderColor #5C6B73
			BackgroundColor #5C6B73
			FontColor #FFFFFF
		}

	}
}

box "Tradeshift.MyApp iframe" #E0FBFC
	participant "Tradeshift.MyApp"
	participant "ts.app"
	participant "ts.amp.Client"
end box
box "tradeshift-chrome topframe" #C2DFE3
	participant "ts.amp.Server"
	participant "tradeshift-chrome"
end box
box "Other.App iframe" #9DB4C0
	participant "Other ts.amp.Client"
end box

...

"Tradeshift.MyApp" ->> "ts.app": ""ts.app.subscribe(Array<ts.app.Subscription>)""
activate "ts.app"
"ts.app" ->> "ts.amp.Client"
"ts.amp.Client" ->> "ts.amp.Server": ""SUBSCRIBE({"topic0", QoS=0}, {"topic1", QoS=1}, {"topic2", QoS=2}, {"topic3", QoS=1})""
hnote over "ts.amp.Server": Identify Client
"ts.amp.Server" ->> "ts.amp.Server": ""ts.amp.Server.unsubscribe(Array<ts.amp.Subscription>)""
"ts.amp.Client" <<- - "ts.amp.Server": ""SUBACK(0, 1, 2, 128)""
note right of "ts.amp.Server": Server will forward the messages for requested subscription after sending ""SUBACK""\nSee @Receiving
deactivate "ts.app"

...

newpage Unsubscribing - ""ts.app.unsubscribe()""

skinparam {
	DefaultFontName Open Sans
	Padding 5
	BoxPadding 10
	Note {
		BackgroundColor #E8F6FF
		FontColor #1F2D3D
		BorderColor #224F6B
	}

	sequence {
		Group {
			FontSize 12
			BackgroundColor #EAFFFF
			BodyBackgroundColor #F4FFFF
			BorderColor #9DB4C0
			BorderThickness 1
		}

		Arrow {
			Color #253237
			Thickness 2
		}

		LifeLine {
			BorderColor #5C6B73
		}

		Participant {
			BorderColor #5C6B73
			BackgroundColor #5C6B73
			FontColor #FFFFFF
		}

	}
}

box "Tradeshift.MyApp iframe" #E0FBFC
	participant "Tradeshift.MyApp"
	participant "ts.app"
	participant "ts.amp.Client"
end box
box "tradeshift-chrome topframe" #C2DFE3
	participant "ts.amp.Server"
	participant "tradeshift-chrome"
end box
box "Other.App iframe" #9DB4C0
	participant "Other ts.amp.Client"
end box

...

"Tradeshift.MyApp" ->> "ts.app": ""ts.app.unsubscribe(Array<ts.app.Subscription>)""
activate "ts.app"
"ts.app" ->> "ts.amp.Client"
"ts.amp.Client" ->> "ts.amp.Server": ""UNSUBSCRIBE("topic0", "topic1", "topic2)""
hnote over "ts.amp.Server": Identify Client
"ts.amp.Server" ->> "ts.amp.Server": ""ts.amp.Server.subscribe(Array<ts.amp.Subscription>)""
"ts.amp.Client" <<- - "ts.amp.Server": ""UNSUBACK""
note right of "ts.amp.Server": Server will not forward any more messages for this subscription after sending ""UNSUBACK""\nIt does finish sending any messages that were in progress(QoS1, QoS2)
deactivate "ts.app"

...

newpage Exchange - ""ts.app.exchange()"" / Load - ""ts.app.load()""

skinparam {
	DefaultFontName Open Sans
	Padding 5
	BoxPadding 10
	Note {
		BackgroundColor #E8F6FF
		FontColor #1F2D3D
		BorderColor #224F6B
	}

	sequence {
		Group {
			FontSize 12
			BackgroundColor #EAFFFF
			BodyBackgroundColor #F4FFFF
			BorderColor #9DB4C0
			BorderThickness 1
		}

		Arrow {
			Color #253237
			Thickness 2
		}

		LifeLine {
			BorderColor #5C6B73
		}

		Participant {
			BorderColor #5C6B73
			BackgroundColor #5C6B73
			FontColor #FFFFFF
		}

	}
}

box "Tradeshift.MyApp iframe" #E0FBFC
	participant "Tradeshift.MyApp"
	participant "ts.app"
	participant "ts.amp.Client"
end box
box "tradeshift-chrome topframe" #C2DFE3
	participant "ts.amp.Server"
	participant "tradeshift-chrome"
end box
box "Other.App iframe" #9DB4C0
	participant "Other ts.amp.Client"
end box

...

"ts.app" ->> "ts.amp.Client": ""ts.app.exchange(ts.app.Message)""
activate "ts.app"
"ts.amp.Client" ->> "ts.amp.Server": ""SUBSCRIBE("exchange topic", QoS=1, retain=false)""
hnote over "ts.amp.Server": Identify Client
"ts.amp.Server" ->> "ts.amp.Server": ""ts.amp.Server.subscribe(Array<ts.amp.Subscription>)""
"ts.amp.Client" <<- - "ts.amp.Server": ""SUBACK(1)""
"ts.amp.Client" ->> "ts.amp.Server": ""PUBLISH("exchange topic", payload={request}, QoS=1, retain=false)""
hnote over "ts.amp.Server": Identify Client
"ts.amp.Client" <<- - "ts.amp.Server": ""PUBACK""
"ts.amp.Server" ->> "Other ts.amp.Client": ""PUBLISH("exchange topic", payload={request}, QoS=1, retain=false)""
"ts.amp.Server" <<- - "Other ts.amp.Client": ""PUBACK""
hnote over "ts.amp.Server": Identify Client
alt Success, other app is listening and responding
	"ts.amp.Server" <<- "Other ts.amp.Client": ""PUBLISH("exchange topic", payload={loading: true}, QoS=1, retain=false)""
	hnote over "ts.amp.Server": Identify Client
	"ts.amp.Server" - ->> "Other ts.amp.Client": ""PUBACK""
	loop While we're waiting for user interaction to finish
		"ts.amp.Server" <<- "Other ts.amp.Client": ""PINGREQ""
		hnote over "ts.amp.Server": Identify Client
		"ts.amp.Server" - ->> "Other ts.amp.Client": ""PINGRES""
		"ts.amp.Client" ->> "ts.amp.Server": ""PINGREQ""
		hnote over "ts.amp.Server": Identify Client
		"ts.amp.Client" <<- - "ts.amp.Server": ""PINGRES""
	end
	"ts.amp.Server" <<- "Other ts.amp.Client": ""PUBLISH("exchange topic", payload={response}, QoS=1, retain=false)""
	hnote over "ts.amp.Server": Identify Client
	"ts.amp.Server" - ->> "Other ts.amp.Client": ""PUBACK""
	"ts.amp.Client" <<- "ts.amp.Server": ""PUBLISH("exchange topic", payload={response}, QoS=1, retain=false)""
	"ts.amp.Client" - ->> "ts.amp.Server": ""PUBACK""
	hnote over "ts.amp.Server": Identify Client
else Failure, other app is not listening or responding
	note over "ts.amp.Server":No meaningful response from other app within ""keepAlive"" seconds
	"ts.amp.Client" <<- "ts.amp.Server": ""PUBLISH("exchange topic", payload={err}, QoS=1, retain=false)""
	"ts.amp.Client" - ->> "ts.amp.Server": ""PUBACK""
	hnote over "ts.amp.Server": Identify Client
end
deactivate "ts.app"
"ts.amp.Client" ->> "ts.amp.Server": ""UNSUBSCRIBE("exchange topic")""
hnote over "ts.amp.Server": Identify Client
"ts.amp.Server" ->> "ts.amp.Server": ""ts.amp.Server.unsubscribe(Array<ts.amp.Subscription>)""
"ts.amp.Client" <<- - "ts.amp.Server": ""UNSUBACK""

...

newpage Unexpected disconnect

skinparam {
	DefaultFontName Open Sans
	Padding 5
	BoxPadding 10
	Note {
		BackgroundColor #E8F6FF
		FontColor #1F2D3D
		BorderColor #224F6B
	}

	sequence {
		Group {
			FontSize 12
			BackgroundColor #EAFFFF
			BodyBackgroundColor #F4FFFF
			BorderColor #9DB4C0
			BorderThickness 1
		}

		Arrow {
			Color #253237
			Thickness 2
		}

		LifeLine {
			BorderColor #5C6B73
		}

		Participant {
			BorderColor #5C6B73
			BackgroundColor #5C6B73
			FontColor #FFFFFF
		}

	}
}

box "Tradeshift.MyApp iframe" #E0FBFC
	participant "Tradeshift.MyApp"
	participant "ts.app"
	participant "ts.amp.Client"
end box
box "tradeshift-chrome topframe" #C2DFE3
	participant "ts.amp.Server"
	participant "tradeshift-chrome"
end box
box "Other.App iframe" #9DB4C0
	participant "Other ts.amp.Client"
end box

...
note over "ts.amp.Client": No messages sent for ""keepAlive"" seconds
"ts.amp.Server" -> "ts.amp.Server": ts.amp.Server.unsubscribe()
note right of "ts.amp.Server": Unsubscribe Client from all of its subscriptions

opt If ""ts.amp.Client"" has a ""will"" defined
	loop For each client subscribed to "will topic"
		alt QoS Level 0
			"ts.amp.Server" ->> "Other ts.amp.Client": ""PUBLISH("will topic", payload, QoS=0)""
		else QoS Level 1
			"ts.amp.Server" ->> "Other ts.amp.Client": ""PUBLISH("will topic", payload, QoS=1)""
			"ts.amp.Server" <<- - "Other ts.amp.Client": ""PUBACK""
			hnote over "ts.amp.Server": Identify Client
			"ts.amp.Server" ->> "ts.amp.Server": Delete message
		else QoS Level 2
			"ts.amp.Server" ->> "Other ts.amp.Client": ""PUBLISH("will topic", payload, QoS=2)""
			"ts.amp.Server" <<- - "Other ts.amp.Client": ""PUBREC""
			hnote over "ts.amp.Server": Identify Client
			"ts.amp.Server" ->> "Other ts.amp.Client": ""PUBREL"
			"ts.amp.Server" <<- - "Other ts.amp.Client": ""PUBCOMP""
			hnote over "ts.amp.Server": Identify Client
			"ts.amp.Server" ->> "ts.amp.Server": Delete message
		end
	end
end

...

newpage Disconnecting - ""ts.app.disconnect()""

skinparam {
	DefaultFontName Open Sans
	Padding 5
	BoxPadding 10
	Note {
		BackgroundColor #E8F6FF
		FontColor #1F2D3D
		BorderColor #224F6B
	}

	sequence {
		BoxBorderColor #9DB4C0
		Group {
			BackgroundColor #EAFFFF
			BodyBackgroundColor #F4FFFF
			BorderColor #9DB4C0
			BorderThickness 1
		}

		Arrow {
			Color #253237
			Thickness 2
		}

		LifeLine {
			BorderColor #5C6B73
		}

		Participant {
			BorderColor #5C6B73
			BackgroundColor #5C6B73
			FontColor #FFFFFF
		}

	}
}

box "Tradeshift.MyApp iframe" #E0FBFC
	participant "Tradeshift.MyApp"
	participant "ts.app"
	participant "ts.amp.Client"
end box
box "tradeshift-chrome topframe" #C2DFE3
	participant "ts.amp.Server"
	participant "tradeshift-chrome"
end box
box "Other.App iframe" #9DB4C0
	participant "Other ts.amp.Client"
end box

...

[-> "ts.app": ts.app.disconnect()
"ts.app" -> "ts.amp.Client"
"ts.amp.Client" -> "ts.amp.Server": ""DISCONNECT""
hnote over "ts.amp.Server": Identify Client
"ts.amp.Server" -> "ts.amp.Server": ts.amp.Server.unsubscribe()
note right of "ts.amp.Server": Unsubscribe Client from all of its subscriptions

@enduml

PlantUML version 1.2017.15(Mon Jul 03 18:45:34 CEST 2017)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1024-b8
Operating System: Mac OS X
OS Version: 10.13.2
Default Encoding: UTF-8
Language: en
Country: DK
--></g></svg>